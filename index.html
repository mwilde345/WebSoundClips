<!DOCTYPE html>
<html>

<head>
  <title>
    Sound Clips
  </title>
  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

  <!-- jQuery library -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

  <!-- Latest compiled JavaScript -->
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <!-- <script src="node_modules/peaks.js/peaks.js"></script>  -->
  <script src="node_modules/peaks.js/peaks.js"></script>
  
</head>

<body>

  <!-- Youtube Player Iframe and Logging buttons -->
  <!-- ######################################### -->

  <div id="player"></div>
  <div id="button1">
    <button onclick="logTime()">Log Time</button>
  </div>
  <div id="button2">
    <button onclick="resetTime()">Reset</button>
  </div>
  <div id="button3">
    <button onclick="undoTime()">Undo</button>
  </div>
  <div id="button4">
    <button onclick="download()">Download MP3</button>
  </div>

  <!-- Table to store video times -->
  <!-- ########################## -->

  <div id="output" class="container">
    <div class="col-md-2" id="tableContainer">
      <table id="table" class="table">
        <thead>
          <tr>
            <th>Start</th>
            <th>Stop</th>
          </tr>
        </thead>
        <tbody id="tableBody">
        </tbody>
      </table>
    </div>
  </div>

  <!-- Waveform container and controls-->
  <!-- ############################## -->

  <div id="first-waveform-visualiser-container"></div>
  <div id="audioStuff" class="jumbotron">
  <audio controls=controls src="swansonlocal.mp3" type="audio/mpeg">
    Your browser does not support the audio element.
  </audio>
  
  <div id="controls">
    <div>
      <button data-action="zoom-in">Zoom in</button>
      <button data-action="zoom-out">Zoom out</button>
      <button data-action="add-segment">Add a Segment at current time</button>
      <button data-action="add-point">Add a Point at current time</button>
      <button data-action="log-data">Log segments/points</button>
    </div>
    <div>
      <input type="text" id="seek-time" value="0.0">
      <button data-action="seek">Seek</button>
    </div>
  </div>

  <div class="log">
    <div id="segments" class="hide">
      <h2>Segments</h2>
      <table class="table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Label</th>
            <th>Start time</th>
            <th>End time</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
        </tbody>
      </table>
    </div>

    <div id="points" class="hide">
      <h2>Points</h2>
      <table>
        <thead>
          <tr>
            <th>ID</th>
            <th>Label</th>
            <th>Time</th>
          </tr>
        </thead>
        <tbody>
        </tbody>
      </table>
    </div>
  </div>
</div>

  <!-- Other js functions -->
  <!-- ################## -->
  <script src="js/playerjs.js"></script>
  <script src="js/peaksHelper.js"></script>
  <script>
    function download() {
      var data = {};
      data.url = "https://www.youtube.com/watch?v=V_laNt7Sh6g";
      //allow overwrite! also if you push the download button multiple times,
      //we don't want multiple peaks made.
      //also, don't load the <audio> element until after the conversion is completed.....
      $.ajax({
        type: "POST",
        url: "/test",
        data: JSON.stringify(data),
        contentType: 'application/json',
        success: function (data) {
          console.log(data);
          $("#output").append("downloaded");
          gatherData();
          //var peaksInstance = Peaks.init(options);
          //load <audio> tag with filename (so it gets the new file if overwritten)
          peaksFunction(peaks);
          //peaksSetup();

        }
      })
    }

    function gatherData() {
      var startTimes = [];
      var stopTimes = [];
      $("#table tr").each(function (index) {
        var col1 = $($(this).children()[0]).text();
        startTimes.push(col1);
        var col2 = $($(this).children()[1]).text();
        stopTimes.push(col2);
      });
    }

    function peaksSetup() {
      var myAudioContext = new AudioContext();
      var p = Peaks.init({
        container: document.querySelector('#peaks-container'),
        mediaElement: document.querySelector('audio'),
        audioContext: myAudioContext
      });

      p.on('peaks.ready', function () {
        // do something when the waveform is displayed and ready
      });
    }
    /* function editButtons(){
          $("#button4").html("Save Edits");
          //$("#");
        }
  
        function saveEdits(){
  
        }*/
  </script>
</body>

</html>